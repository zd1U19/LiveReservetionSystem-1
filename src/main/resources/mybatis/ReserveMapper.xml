<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.app.mapper.ReserveMapper">

	<sql id="joinSelect">
		SELECT
		  reserves.id, 
		  reserves.name, 
		  reserves.email,
		  reserves.phone,
		  reserves.live_id, 
		  reserves.note, 
		  reserves.reserved_at
		FROM reserves
	</sql>

	<resultMap id="reserveMap" type="Reserve">
		<id column="id" property="reserveId" />
		<result column="name" property="name" />
		<result column="email" property="email" />
		<result column="phone" property="phone" />
		<result column="live_id" property="liveId" />
		<result column="note" property="note" />
		<result column="reserved_at" property="reservedAt" />
	</resultMap>

	<select id="findAll" resultMap="reserveMap">
		<include refid="joinSelect" />
	</select>

	<select id="selectByReserveId" parameterType="int" resultMap="reserveMap">
		<include refid="joinSelect" />
		WHERE reserves.id = #{reserveId}
	</select>

	<insert id="insert" parameterType="Reserve">
		INSERT INTO reserves(
		  name,
		  email,
		  phone,
		  live_id,
		  note,
		  reserved_at
		 )
		VALUES(
		  #{name},
		  #{email},
		  #{phone},
		  #{liveId},
		  #{note},
		  NOW()
		)
	</insert>

	<update id="update" parameterType="Reserve">
		UPDATE reserves
		SET 
		  name = #{name},
		  email = #{email},
		  phone = #{phone},
		  live_id =#{liveId},
		  note = #{note}
		WHERE id = #{reserveId}
	</update>

	<delete id="delete" parameterType="int">
		DELETE FROM reserves WHERE id = #{reserveId}
	</delete>
	
	<select id="totalPages" parameterType="int" resultType="int">
        SELECT CEIL(COUNT(*) / #{numPerPage}) FROM reserves
    </select>
</mapper>
 